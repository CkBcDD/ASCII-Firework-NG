# 开发规范

本文档定义本项目的日志与注释实践，目标是在保证可维护性的前提下，避免过度注释与日志噪声。

## 日志规范

### 1. 日志级别与语义

- `debug`：调试细节（高频、可被静默）。
- `info`：关键流程状态（启动、恢复、完成等）。
- `warn`：可恢复异常或降级行为。
- `error`：功能失败、不可忽略的错误。
- `silent`：完全关闭日志输出。

### 2. 全局日志粒度配置

- 配置项位于 [src/config.ts](../src/config.ts)：`LOG_LEVEL`。
- 启动时在 [src/app/bootstrap.ts](../src/app/bootstrap.ts) 调用 `setLogLevel(LOG_LEVEL)`。
- 级别比较规则：仅输出 `日志级别 >= LOG_LEVEL` 的日志。

### 3. 记录原则

- 默认使用 `createLogger('模块名')`，模块名保持短且稳定。
- 日志消息应包含可定位信息（如状态、阈值、尺寸、关键参数）。
- 避免在高频循环中输出 `info/warn/error`；高频信息优先使用 `debug`。
- 不记录敏感信息。

## 注释规范

### 1. 公共 API 注释（推荐 TSDoc）

以下导出成员必须写注释：

- `export` 的函数、类型、接口、常量（若语义不直观）。
- 框架/模块边界上的能力声明（如 `createXxx` 工厂函数）。

建议模板：

```ts
/**
 * 简要说明职责。
 *
 * @param x 参数含义
 * @returns 返回值语义
 */
```

### 2. 复杂逻辑注释

以下场景必须补“为什么”的注释：

- 性能策略（阈值、降级、节流、防抖）。
- 视觉/算法策略（例如插值、缓动、采样、增量重绘）。
- 容易误改的边界行为。

注释应解释设计意图，不重复代码字面含义。

### 3. 不需要注释的场景

- 命名已清晰且逻辑线性短小的实现。
- 一眼可读的简单赋值、转发调用。

## 提交流程建议

- 在本地至少执行一次：
  - `npm run lint`
  - `npm run build`
- 变更 `LOG_LEVEL`、日志策略或注释规则时，同步更新本文档。
